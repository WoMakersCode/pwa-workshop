<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3. Precaching and basic offline mode | PWA Workshop</title>
    <meta name="description" content="Introduction to Progressive Web Applications">
    <link rel="manifest" href="manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="application-name" content="PWA Workshop Docs">
  <meta name="apple-mobile-web-app-title" content="PWA Workshop Docs">
    
    <link rel="preload" href="https://womakerscode.github.io/pwa-workshop/css/0.styles.29df42ad.css" as="style"><link rel="preload" href="https://womakerscode.github.io/pwa-workshop/js/app.27d2dbf1.js" as="script"><link rel="preload" href="https://womakerscode.github.io/pwa-workshop/js/3.f38c0f84.js" as="script"><link rel="preload" href="https://womakerscode.github.io/pwa-workshop/js/8.da3dd183.js" as="script"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/10.9725dfa9.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/11.3ab35c1a.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/12.1d8783c0.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/13.12e452ca.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/14.f551e499.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/15.d183389d.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/16.2bd9d4ec.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/17.e0c70547.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/18.1ac62902.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/19.c1d9eee1.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/2.23c6cee6.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/20.16db73fe.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/21.cd131399.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/4.f0dfd132.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/5.7c9ddfb1.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/6.4db51655.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/7.67599f73.js"><link rel="prefetch" href="https://womakerscode.github.io/pwa-workshop/js/9.c634f727.js">
    <link rel="stylesheet" href="https://womakerscode.github.io/pwa-workshop/css/0.styles.29df42ad.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">PWA Workshop</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://pwa-cookbook.js.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Cookbook
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/sylvainpolletvillard/pwa-workshop" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Language</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/3-precaching/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/fr/3-precaching/" class="nav-link">Français</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://pwa-cookbook.js.org" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Cookbook
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/sylvainpolletvillard/pwa-workshop" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Language</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/3-precaching/" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/fr/3-precaching/" class="nav-link">Français</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/" class="sidebar-link">Introduction</a></li><li><a href="/1-manifest/" class="sidebar-link">1. Adding a Web App Manifest</a></li><li><a href="/2-service-worker/" class="sidebar-link">2. Install a Service Worker</a></li><li><a href="/3-precaching/" class="active sidebar-link">3. Precaching and basic offline mode</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/3-precaching/#overview-of-promises-and-async-await" class="sidebar-link">Overview of promises and async/await</a></li><li class="sidebar-sub-header"><a href="/3-precaching/#exploring-caching-apis" class="sidebar-link">Exploring caching APIs</a></li><li class="sidebar-sub-header"><a href="/3-precaching/#adding-static-files-to-the-cache" class="sidebar-link">Adding static files to the cache</a></li><li class="sidebar-sub-header"><a href="/3-precaching/#response-with-cache-in-priority" class="sidebar-link">Response with cache in priority</a></li><li class="sidebar-sub-header"><a href="/3-precaching/#testing-offline" class="sidebar-link">Testing offline</a></li><li class="sidebar-sub-header"><a href="/3-precaching/#update-the-static-cache" class="sidebar-link">Update the static cache</a></li><li class="sidebar-sub-header"><a href="/3-precaching/#installing-the-pwa" class="sidebar-link">Installing the PWA</a></li><li class="sidebar-sub-header"><a href="/3-precaching/#links" class="sidebar-link">Links</a></li></ul></li><li><a href="/4-api-cache/" class="sidebar-link">4. Cache Strategy for REST API</a></li><li><a href="/5-background-sync/" class="sidebar-link">5. Background sync and notifications</a></li><li><a href="/6-pwa-setup/" class="sidebar-link">6. Showing the install button prompt</a></li><li><a href="/finish.html" class="sidebar-link">To go further</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="step-3-precaching-static-assets-for-a-basic-offline-mode"><a href="#step-3-precaching-static-assets-for-a-basic-offline-mode" aria-hidden="true" class="header-anchor">#</a> Step 3: Precaching static assets for a basic offline mode</h1> <p>We saw in the previous step two methods of the Service Worker life cycle: <code>install</code> and<code>activate</code>. In this part, we will continue our exploration of PWA by caching static files.</p> <h2 id="overview-of-promises-and-async-await"><a href="#overview-of-promises-and-async-await" aria-hidden="true" class="header-anchor">#</a> Overview of promises and async/await</h2> <p>Service worker APIs rely heavily on promises. Let's take a quick look on how they work.</p> <p><em>You can try the code in this section using node or an online editor such as <a href="https://repl.it/languages/nodejs" target="_blank" rel="noopener noreferrer">https://repl.it<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></em></p> <p>Promises provide a way to transform an asynchronous function to an object which allows us to react when the function completes.
The ES2015 allows to create promises using this constructor:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// async function execution</span>
  <span class="token comment">// resolve is called on success</span>
  <span class="token comment">// reject is called on failure</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We will not use this kind of constructor however because the Service worker APIs provide functions that return a promise, as illustrated by the following example:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">someAsyncServiceWorlerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// async function execution</span>
  <span class="token comment">// resolve is called on success</span>
  <span class="token comment">// reject is called on failure</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token function">someAsyncServiceWorlerFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Here is a more concrete example of a promise that generates a random number after a 1 second delay. It succeeds when the generated number is even and fails when the generated number is odd.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">generateRandomNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> nb <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// random number between 0 and 10</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nb <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">resolve</span><span class="token punctuation">(</span>nb<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token function">reject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>message<span class="token punctuation">:</span><span class="token string">&quot;odd number&quot;</span><span class="token punctuation">,</span> number<span class="token punctuation">:</span> nb<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Once we create a promise object, it starts to execute asynchronously. We can use the <code>then()</code> and <code>reject()</code> functions to execute a function when the promises succeeds (it calls <code>resolve</code>) or fails (it calls <code>reject</code>).</p> <p>The following example illustrates how to handle the promise returned by the <code>generateRandomNumber()</code> function. <a href="https://repl.it/@yostane/promise01" target="_blank" rel="noopener noreferrer">Run online<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> promise <span class="token operator">=</span> <span class="token function">generateRandomNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// create a promise that generated a random number asynchronously</span>
promise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// this function is called when the promise succeds</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// this function is called when the promise fails</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Promise example&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this message is shows first because the promise is async</span>
</code></pre></div><p>We can abbreviate the promise call by extracting the <code>then</code> and <code>catch</code> handlers as functions. <a href="https://repl.it/@yostane/promise02" target="_blank" rel="noopener noreferrer">Run online<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">handleSuccess</span><span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">handleFailure</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">generateRandomNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>handleSuccess<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>handleFailure<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Promise example&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this message is shows first because the promise is async</span>
</code></pre></div><p>Promises can be easily chained. The following example generates a new random number asynchronously after the first one has been generated and printed. <a href="https://repl.it/@yostane/promise03" target="_blank" rel="noopener noreferrer">Run online<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">handleSuccess</span><span class="token punctuation">(</span><span class="token parameter">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">handleFailure</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">generateRandomNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>handleSuccess<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>generateRandomNumber<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>handleSuccess<span class="token punctuation">)</span> <span class="token comment">// chain a second promise and handle is result</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span>handleFailure<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// if any of the prevous calls fails, catch is called</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Promise example&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// this message is shows first because the promise is async</span>
</code></pre></div><p>There is alternative way for calling and chaining promises. Instead of calling the <code>then</code> function and pass it another function that processes the result. We can retrieve the result when it becomes is available without passing function. This is called awaiting the result and uses the <code>async/await</code> keywords. With this method, the catch method is replaced by a <code>try/catch</code> block.</p> <p>The following code snippet transforms the last example to use <code>async/await</code>. <a href="https://repl.it/@yostane/promise04" target="_blank" rel="noopener noreferrer">Run online<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// If we want to use await, we must be place the code in async function</span>
<span class="token comment">// More reading https://github.com/tc39/proposal-top-level-await, https://gist.github.com/Rich-Harris/0b6f317657f5167663b493c722647221</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">mainAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
        <span class="token keyword">const</span> nb1 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">generateRandomNumberAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// create the promise and wait for its result (the parameter passed to resolve) asynchrnously without blocking the javascirpt thread</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nb1<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// nb1 is not the promise but rather its result in case of success (the parameter passed to resolve)</span>
        <span class="token keyword">const</span> nb2 <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">generateRandomNumberAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// create the promise and wait for its result (the parameter passed to resolve) asynchrnously without blocking the javascirpt thread</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nb2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// this catch block is executed if any promise fails</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// The error object is the value passed to reject</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">mainAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// call the function that runs async code</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Promise example with async / await&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This concludes this overview about promises and async/await.
With this knowledge acquired, we can use the caching APIs of the service worker more serenely.</p> <p><em>If you still feel uncomfortable with promises, here are some exercices: <a href="https://github.com/asakusuma/promise-workshop" target="_blank" rel="noopener noreferrer">set 1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://repl.it/@AdamCahan/Promise-practice-exercises" target="_blank" rel="noopener noreferrer">set 2<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <a href="https://developers.google.com/web/ilt/pwa/lab-promises" target="_blank" rel="noopener noreferrer">set 3<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></em></p> <h2 id="exploring-caching-apis"><a href="#exploring-caching-apis" aria-hidden="true" class="header-anchor">#</a> Exploring caching APIs</h2> <p>Of the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API" target="_blank" rel="noopener noreferrer">APIs that the Service Worker has access to<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, the one we are interested in is <a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache" target="_blank" rel="noopener noreferrer">Cache API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. Indeed, it makes it possible to put in a persistent cache the requests/responses pairs with the method <code>cache.put(request, response)</code>. It is also possible to pass one or more URLs as arguments to the <code>cache.add</code> and <code>cache.addAll</code> methods; they will be requested and the network response will be added to the cache. You can also delete cache entries with the <code>cache.delete</code> method.</p> <p>The different caches are accessible through the <code>caches</code> variable from the Service Worker. It is the <a href="https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage" target="_blank" rel="noopener noreferrer">CacheStorage API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> which allows, among other things, to create / retrieve a cache object or to delete one with the <code>caches.open</code> and <code>caches.delete</code> functions.</p> <p>Finally, another interesting method of the cache is <code>match</code>: it checks in all <code>Cache</code> objects managed by the <code>CacheStorage</code> if a request is identical to that passed in parameter. If so, it returns a Promise resolved with the cached response.</p> <h2 id="adding-static-files-to-the-cache"><a href="#adding-static-files-to-the-cache" aria-hidden="true" class="header-anchor">#</a> Adding static files to the cache</h2> <p>We will cache the essential static files of the application as soon as possible. The best timing to do this is when the <code>install</code> event is triggered, because it is only called once at Service Worker installation. This is called <em>precaching</em>.</p> <ol><li>Go to <code>sw.js</code> in the <code>install</code> event callback as seen in step 2.</li> <li>Open the cache with <a href="https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage/open" target="_blank" rel="noopener noreferrer"><code>caches.open('V1')</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, which returns a Promise resolved with the <code>cache</code> object. The version number in the cache name will be useful for future updates.</li> <li>Once the cache is open, add to the cache with <a href="https://developer.mozilla.org/en-US/docs/Web/API/Cache/addAll" target="_blank" rel="noopener noreferrer"><code>cache.addAll(['url1', 'url2', ...])</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. the URLs to the essential static files of our application: the root HTML page, the <code>styles.css</code> file and the<code>scripts.js</code> file.</li> <li>In order for the Service Worker to activate after precaching is complete, pass the <code>Promise</code> returned by <code>cache.addAll</code> as an argument to <a href="https://developer.mozilla.org/en-US/docs/Web/API/ExtendableEvent/waitUntil" target="_blank" rel="noopener noreferrer"><code>event.waitUntil ()</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>, <code>event</code> being the installation event.</li></ol> <details class="hidden" data-v-1bf9d1e0><summary data-v-1bf9d1e0>See the solution</summary> <div class="language-js extra-class" data-v-1bf9d1e0><pre class="language-js" data-v-1bf9d1e0><code data-v-1bf9d1e0><span class="token keyword" data-v-1bf9d1e0>const</span> <span class="token constant" data-v-1bf9d1e0>CACHE_NAME</span> <span class="token operator" data-v-1bf9d1e0>=</span> <span class="token string" data-v-1bf9d1e0>'V1'</span><span class="token punctuation" data-v-1bf9d1e0>;</span>
<span class="token keyword" data-v-1bf9d1e0>const</span> <span class="token constant" data-v-1bf9d1e0>STATIC_CACHE_URLS</span> <span class="token operator" data-v-1bf9d1e0>=</span> <span class="token punctuation" data-v-1bf9d1e0>[</span><span class="token string" data-v-1bf9d1e0>'/'</span><span class="token punctuation" data-v-1bf9d1e0>,</span> <span class="token string" data-v-1bf9d1e0>'styles.css'</span><span class="token punctuation" data-v-1bf9d1e0>,</span> <span class="token string" data-v-1bf9d1e0>'scripts.js'</span><span class="token punctuation" data-v-1bf9d1e0>]</span><span class="token punctuation" data-v-1bf9d1e0>;</span>

self<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>addEventListener</span><span class="token punctuation" data-v-1bf9d1e0>(</span><span class="token string" data-v-1bf9d1e0>'install'</span><span class="token punctuation" data-v-1bf9d1e0>,</span> <span class="token parameter" data-v-1bf9d1e0>event</span> <span class="token operator" data-v-1bf9d1e0>=&gt;</span> <span class="token punctuation" data-v-1bf9d1e0>{</span>
  console<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>log</span><span class="token punctuation" data-v-1bf9d1e0>(</span><span class="token string" data-v-1bf9d1e0>'Service Worker installing.'</span><span class="token punctuation" data-v-1bf9d1e0>)</span><span class="token punctuation" data-v-1bf9d1e0>;</span>
  event<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>waitUntil</span><span class="token punctuation" data-v-1bf9d1e0>(</span>
    caches<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>open</span><span class="token punctuation" data-v-1bf9d1e0>(</span><span class="token constant" data-v-1bf9d1e0>CACHE_NAME</span><span class="token punctuation" data-v-1bf9d1e0>)</span>
    <span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>then</span><span class="token punctuation" data-v-1bf9d1e0>(</span><span class="token parameter" data-v-1bf9d1e0>cache</span> <span class="token operator" data-v-1bf9d1e0>=&gt;</span> cache<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>addAll</span><span class="token punctuation" data-v-1bf9d1e0>(</span><span class="token constant" data-v-1bf9d1e0>STATIC_CACHE_URLS</span><span class="token punctuation" data-v-1bf9d1e0>)</span><span class="token punctuation" data-v-1bf9d1e0>)</span>  
  <span class="token punctuation" data-v-1bf9d1e0>)</span>
<span class="token punctuation" data-v-1bf9d1e0>}</span><span class="token punctuation" data-v-1bf9d1e0>)</span><span class="token punctuation" data-v-1bf9d1e0>;</span>
</code></pre></div></details> <p>Reload the page and the Service Worker, making sure that the new version of the Service Worker replaces the old one as seen in step 2. We can then check that the files are added to the cache by looking at the <em>Cache Storage section</em> in the <em>Application</em> tab of Chrome Developer Tools.</p> <p><img src="https://womakerscode.github.io/pwa-workshop/img/cache_storage.04f1ba9e.png" alt="Cache storage"></p> <h2 id="response-with-cache-in-priority"><a href="#response-with-cache-in-priority" aria-hidden="true" class="header-anchor">#</a> Response with cache in priority</h2> <p>Now that the files are cached, we have to indicate to use their cached version when the browser requests them. To do this, we will use the <code>fetch</code> event. The latter intercepts all requests made by clients who have installed the Service Worker. You can then return a custom response with <code>event.respondWith</code>, where <code>event</code> is the <a href="https://developer.mozilla.org/en-US/docs/Web/API/FetchEvent" target="_blank" rel="noopener noreferrer">FetchEvent<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>. The <a href="https://developer.mozilla.org/en-US/docs/Web/API/FetchEvent/respondWith" target="_blank" rel="noopener noreferrer"><code>event.respondWith</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> function takes as a single argument a Promise that must be resolved with the response to return.</p> <div class="language-js extra-class"><pre class="language-js"><code>self<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'fetch'</span><span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`Request of </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span>request<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// default behaviour: request the network</span>
	event<span class="token punctuation">.</span><span class="token function">respondWith</span><span class="token punctuation">(</span> <span class="token function">fetch</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>request<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>We want to change the default behavior and return previously cached versions if they exist. Precisely, the <a href="https://developer.mozilla.org/en-US/docs/Web/API/CacheStorage/match" target="_blank" rel="noopener noreferrer"><code>caches.match</code><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> function returns a Promise resolved with a<code>Response</code> object, just like <code>fetch (event.request)</code>. So we can replace one by the other and return the static files from cache instead of requesting them from the network.</p> <ol><li>Add a callback for the <code>fetch</code> event, the same way you did for<code>install</code> in the previous step.</li> <li>Call the <code>caches.match(event.request)</code> method to search the cache for a cached response for the corresponding request.</li> <li>If no cache entry is found, the Promise is resolved with the value <code>undefined</code>. In this case, you need to request the network and return <code>fetch(event.request)</code> instead.</li> <li>Finally, return this Promise of Response to the client request by passing it as argument to <code>event.respondWith()</code></li></ol> <details class="hidden" data-v-1bf9d1e0><summary data-v-1bf9d1e0>See the solution</summary> <div class="language-js extra-class" data-v-1bf9d1e0><pre class="language-js" data-v-1bf9d1e0><code data-v-1bf9d1e0>self<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>addEventListener</span><span class="token punctuation" data-v-1bf9d1e0>(</span><span class="token string" data-v-1bf9d1e0>'fetch'</span><span class="token punctuation" data-v-1bf9d1e0>,</span> <span class="token parameter" data-v-1bf9d1e0>event</span> <span class="token operator" data-v-1bf9d1e0>=&gt;</span> <span class="token punctuation" data-v-1bf9d1e0>{</span>
  <span class="token comment" data-v-1bf9d1e0>// Cache-First Strategy</span>
  event<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>respondWith</span><span class="token punctuation" data-v-1bf9d1e0>(</span>
    caches<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>match</span><span class="token punctuation" data-v-1bf9d1e0>(</span>event<span class="token punctuation" data-v-1bf9d1e0>.</span>request<span class="token punctuation" data-v-1bf9d1e0>)</span> <span class="token comment" data-v-1bf9d1e0>// check if the request has already been cached</span>
    <span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>then</span><span class="token punctuation" data-v-1bf9d1e0>(</span><span class="token parameter" data-v-1bf9d1e0>cached</span> <span class="token operator" data-v-1bf9d1e0>=&gt;</span> cached <span class="token operator" data-v-1bf9d1e0>||</span> <span class="token function" data-v-1bf9d1e0>fetch</span><span class="token punctuation" data-v-1bf9d1e0>(</span>event<span class="token punctuation" data-v-1bf9d1e0>.</span>request<span class="token punctuation" data-v-1bf9d1e0>)</span><span class="token punctuation" data-v-1bf9d1e0>)</span> <span class="token comment" data-v-1bf9d1e0>// otherwise request network</span>
  <span class="token punctuation" data-v-1bf9d1e0>)</span><span class="token punctuation" data-v-1bf9d1e0>;</span>
<span class="token punctuation" data-v-1bf9d1e0>}</span><span class="token punctuation" data-v-1bf9d1e0>)</span><span class="token punctuation" data-v-1bf9d1e0>;</span>
</code></pre></div></details> <h2 id="testing-offline"><a href="#testing-offline" aria-hidden="true" class="header-anchor">#</a> Testing offline</h2> <p>If everything has been done correctly, you should now be able to test the application in offline mode. Shut down your local server and try to reload the application. The cached page should be displayed.</p> <h2 id="update-the-static-cache"><a href="#update-the-static-cache" aria-hidden="true" class="header-anchor">#</a> Update the static cache</h2> <p>Caching static files raises a question: what happens if I add, delete, or modify these files on the server ?</p> <p>As we have currently coded our Service Worker, we will always load the cached files, so new versions deployed on the server will never be used.</p> <p>To handle this problem, one solution is to use a new cache with another name. The idea here would be to create a new <strong>V2</strong> cache that contains the new files and remove the previous obsolete cache.</p> <ol><li>In the <code>install</code> event callback, change the cache name to<code>V2</code></li> <li>In the <code>activate</code> event callback, delete the old cache with <code>caches.delete('V1')</code></li> <li>Pass the <code>Promise</code> returned by<code>caches.delete</code> in <code>event.waitUntil</code> in order to wait for the cache to be removed before the end of the activation step</li> <li><em>(optional)</em> - Improve your cache cleanup code by removing all caches that are not in your whitelist of used caches. You can browse all existing caches with the <code>caches.keys()</code> method</li></ol> <details class="hidden" data-v-1bf9d1e0><summary data-v-1bf9d1e0>See the solution</summary> <div class="language-js extra-class" data-v-1bf9d1e0><pre class="language-js" data-v-1bf9d1e0><code data-v-1bf9d1e0><span class="token keyword" data-v-1bf9d1e0>const</span> <span class="token constant" data-v-1bf9d1e0>CACHE_NAME</span> <span class="token operator" data-v-1bf9d1e0>=</span> <span class="token string" data-v-1bf9d1e0>'V2'</span><span class="token punctuation" data-v-1bf9d1e0>;</span>

self<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>addEventListener</span><span class="token punctuation" data-v-1bf9d1e0>(</span><span class="token string" data-v-1bf9d1e0>'activate'</span><span class="token punctuation" data-v-1bf9d1e0>,</span> <span class="token parameter" data-v-1bf9d1e0>event</span> <span class="token operator" data-v-1bf9d1e0>=&gt;</span> <span class="token punctuation" data-v-1bf9d1e0>{</span>
  <span class="token comment" data-v-1bf9d1e0>// delete any unexpected caches</span>
  event<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>waitUntil</span><span class="token punctuation" data-v-1bf9d1e0>(</span>
    caches<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>keys</span><span class="token punctuation" data-v-1bf9d1e0>(</span><span class="token punctuation" data-v-1bf9d1e0>)</span>
    <span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>then</span><span class="token punctuation" data-v-1bf9d1e0>(</span><span class="token parameter" data-v-1bf9d1e0>keys</span> <span class="token operator" data-v-1bf9d1e0>=&gt;</span> keys<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>filter</span><span class="token punctuation" data-v-1bf9d1e0>(</span><span class="token parameter" data-v-1bf9d1e0>key</span> <span class="token operator" data-v-1bf9d1e0>=&gt;</span> key <span class="token operator" data-v-1bf9d1e0>!==</span> <span class="token constant" data-v-1bf9d1e0>CACHE_NAME</span><span class="token punctuation" data-v-1bf9d1e0>)</span><span class="token punctuation" data-v-1bf9d1e0>)</span>
    <span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>then</span><span class="token punctuation" data-v-1bf9d1e0>(</span><span class="token parameter" data-v-1bf9d1e0>keys</span> <span class="token operator" data-v-1bf9d1e0>=&gt;</span> Promise<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>all</span><span class="token punctuation" data-v-1bf9d1e0>(</span>keys<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>map</span><span class="token punctuation" data-v-1bf9d1e0>(</span><span class="token parameter" data-v-1bf9d1e0>key</span> <span class="token operator" data-v-1bf9d1e0>=&gt;</span> <span class="token punctuation" data-v-1bf9d1e0>{</span>
        console<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>log</span><span class="token punctuation" data-v-1bf9d1e0>(</span><span class="token template-string" data-v-1bf9d1e0><span class="token string" data-v-1bf9d1e0>`Deleting cache </span><span class="token interpolation" data-v-1bf9d1e0><span class="token interpolation-punctuation punctuation" data-v-1bf9d1e0>${</span>key<span class="token interpolation-punctuation punctuation" data-v-1bf9d1e0>}</span></span><span class="token string" data-v-1bf9d1e0>`</span></span><span class="token punctuation" data-v-1bf9d1e0>)</span><span class="token punctuation" data-v-1bf9d1e0>;</span>
        <span class="token keyword" data-v-1bf9d1e0>return</span> caches<span class="token punctuation" data-v-1bf9d1e0>.</span><span class="token function" data-v-1bf9d1e0>delete</span><span class="token punctuation" data-v-1bf9d1e0>(</span>key<span class="token punctuation" data-v-1bf9d1e0>)</span>
    <span class="token punctuation" data-v-1bf9d1e0>}</span><span class="token punctuation" data-v-1bf9d1e0>)</span><span class="token punctuation" data-v-1bf9d1e0>)</span><span class="token punctuation" data-v-1bf9d1e0>)</span>
  <span class="token punctuation" data-v-1bf9d1e0>)</span><span class="token punctuation" data-v-1bf9d1e0>;</span>
<span class="token punctuation" data-v-1bf9d1e0>}</span><span class="token punctuation" data-v-1bf9d1e0>)</span><span class="token punctuation" data-v-1bf9d1e0>;</span>
</code></pre></div></details> <p><img src="https://womakerscode.github.io/pwa-workshop/img/schema.f921f8d6.png" alt="Flowsheet"></p> <h2 id="installing-the-pwa"><a href="#installing-the-pwa" aria-hidden="true" class="header-anchor">#</a> Installing the PWA</h2> <p>Depending on the browser and OS, the technical requirements to install the PWA on the system may vary. But in theory, if you have a manifest and an active Service Worker handling incoming requests with <code>fetch</code>, then you should be able to install that PWA on all supported platforms, and they will leverage the manifest and Service Worker.</p> <p>The installation of PWA is supported on Chrome OS but still experimental on other systems with Chrome. You can enable the installation of PWA with Chrome by enabling this flag: <strong>chrome://flags/#enable-pwa-full-code-cache</strong>; but the support is still incomplete.</p> <p>The platform with the best support today is <strong>Android</strong>. If you have an Android smartphone that can connect to your server by sharing a local connection, then try to load the app through Chrome for Android. Once the web page is open, the Chrome menu should include the option: <strong>Add to home screen</strong></p> <p><img src="https://womakerscode.github.io/pwa-workshop/img/pwa_install_menu.41073796.jpg" alt="Add to home screen"></p> <p>Continue the installation. A new shortcut should appear in your phone home screen. This is the shortcut to our PWA!</p> <p><img src="https://womakerscode.github.io/pwa-workshop/img/pwa_install.cc0b35b6.jpg" alt="PWA bookmark"> <img src="https://womakerscode.github.io/pwa-workshop/img/splash-screen.a247c4ec.jpg" alt="Splash-screen"></p> <p>Once the PWA is installed, when you click on the shortcut, a splash screen is displayed briefly. It uses the colors and icons specified in the web app manifest.</p> <p>You will also notice that the URL bar and the rest of the browser UI are no longer shown if you have set the <code>display</code> property to <code>standalone</code> in the manifest.</p> <p><img src="https://womakerscode.github.io/pwa-workshop/img/pwa-fullscreen.20336af1.jpg" alt="PWA run from bookmark"></p> <h2 id="links"><a href="#links" aria-hidden="true" class="header-anchor">#</a> Links</h2> <p><a href="https://javascript.developpez.com/actu/146280/Comprendre-les-Promises-en-JavaScript-TypeScript-article-de-yahiko/" target="_blank" rel="noopener noreferrer">Comprendre les Promises en JavaScript / TypeScript<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/2-service-worker/" class="prev">
          2. Install a Service Worker
        </a></span> <span class="next"><a href="/4-api-cache/">
          4. Cache Strategy for REST API
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="https://womakerscode.github.io/pwa-workshop/js/app.27d2dbf1.js" defer></script><script src="https://womakerscode.github.io/pwa-workshop/js/3.f38c0f84.js" defer></script><script src="https://womakerscode.github.io/pwa-workshop/js/8.da3dd183.js" defer></script>
  </body>
</html>
